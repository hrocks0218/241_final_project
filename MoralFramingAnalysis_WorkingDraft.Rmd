---
title: "Can Exposure to Moral Foundations Affect Our Reactions to Policy Proposals?"
author: "Kevin Hartman, Hanna Rocks, Tim Spittle, and Jay Venkata"
date: "W241 Experiments and Causality (submitted December X, 2019)"
output:
  pdf_document:
    fig_caption: yes
    number_sections: yes
    toc: yes
  md_document:
    variant: markdown
  html_document:
    df_print: paged
    toc: yes
---

```{r setup, include = FALSE}
rm(list=ls())
library(openxlsx)
library(tidyverse)
library(data.table)
library(DiagrammeR)
library(lmtest)
library(sandwich)
library(car)
library(gridExtra)
library(stargazer)
library(cowplot)
library(corrplot)
library(knitr)

stargazer_type = "text" # change to latex when ready to knit

```

\pagebreak

# Background  
_[[TBD]]_  

# Data  
_[[TBD]]_  

```{r import}
results_panel1_raw = read.xlsx("./data/pilot/survey_results_pilot_panel1.xlsx") %>% filter(StartDate != "Start Date")
results_panel2_raw = read.xlsx("./data/pilot/survey_results_pilot_panel2.xlsx") %>% filter(StartDate != "Start Date")
participant_detail_panel1 = read.csv("./data/pilot/participant_detail_pilot_panel1.csv", stringsAsFactors = FALSE)
participant_detail_panel2 = read.csv("./data/pilot/participant_detail_pilot_panel2.csv", stringsAsFactors = FALSE)
```

### Data Cleaning  
_[[TBD]]_  [^1]  

[^1]: _[[Example footnote]]_  

```{r data_cleaning}
results_full = bind_rows(results_panel1_raw %>% mutate(panel = 1)
                         , results_panel2_raw %>% mutate(panel = 2)) %>%
  mutate(arm = case_when(grepl('a', `FC-B_1`, ignore.case = TRUE) ~ "purity_base"
                         , grepl('a', `FC-C_1`, ignore.case = TRUE) ~ "purity_extension"
                         , grepl('a', `FC-D_1`, ignore.case = TRUE) ~ "fairness_base"
                         , grepl('a', `FC-E_1`, ignore.case = TRUE) ~ "fairness_extension"
                         , TRUE ~ "other")) %>%
  merge(bind_rows(participant_detail_panel1, participant_detail_panel2)
        , by.x = "PROLIFIC_PID"
        , by.y = "participant_id"
        , all.x = TRUE) 
```

## Exploratory Analysis  
_[[TBD]]_  

### Study Setup  

```{r exploratory, fig.height = 4, fig.width = 4, fig.align="center", fig.cap="Study Setup"}
arm_counts = results_full %>%
  group_by(arm, panel) %>%
  summarise(count = n())

grViz("digraph flowchart {
      # node definitions with substituted label text
      node [fontname = Helvetica, shape = rectangle]        
      tab1 [label = '@@1']
      tab2 [label = '@@2']
      tab3 [label = '@@3']
      tab4 [label = '@@4']
      tab5 [label = '@@5']
      tab6 [label = '@@6']
      tab7 [label = '@@7']
      tab8 [label = '@@8']
      tab9 [label = '@@9']
      tab10 [label = '@@10']
      tab11 [label = '@@11']

      # edge definitions with the node IDs
      tab1 -> tab2 -> tab3 -> tab4;
      tab1 -> tab2 -> tab5 -> tab6;
      tab1 -> tab7 -> tab8 -> tab9;
      tab1 -> tab7 -> tab10 -> tab11;
      }

      [1]: 'Total n=24 participants'
      [2]: 'Liberals n=12'
      [3]: 'Purity n=8'
      [4]: 'Purity (extension) n=4'
      [5]: 'Fairness n=4'
      [6]: 'Fairness (extension) n=4'
      [7]: 'Conservatives n=12'
      [8]: 'Purity n=8'
      [9]: 'Purity (extension) n=4'
      [10]: 'Fairness n=4'
      [11]: 'Fairness (extension) n=4'
      ")
```

### Demographics  

```{r exploratory_demographics, fig.align="center", fig.cap="Demographics"}
# Age, Gender, Urban, PoliSpect
ideology_levels = c("Very Liberal", "Lean Liberal", "Liberal", "Moderate", "Conservative", "Lean Conservative", "Very Conservative")
age_breakdown = results_full %>% 
  group_by(Age, PoliSpect) %>%
  summarise(count = n()) %>%
  mutate(PoliSpect_factor = factor(PoliSpect, levels = ideology_levels))
ggplot(data = age_breakdown, aes(x = Age, y = count, fill = PoliSpect_factor)) +
  geom_bar(stat="identity") +
  scale_fill_brewer(type = "div", palette = 5, direction = -1, aesthetics = "fill")
```

Example reference to r cell _\autoref{fig:exploratory_demographics}_ shows _[[TBD]]_   

### Reactions  

```{r exploratory_reactions, fig.height = 4, fig.width = 4, fig.align="center", fig.cap="Reactions"}

```

### Outcome  

```{r exploratory_outcome, fig.height = 4, fig.width = 4, fig.align="center", fig.cap="Outcomes"}

```

\pagebreak

# Methodology  

## Model 1  

**Independent variable**  

**Dependent variable**  

**Model specification**  

_[[TBD]]_. (see _\autoref{fig:model_1_explore}_)

```{r methodology_model_1_explore, fig.height = 3, fig.width = 4, fig.align="center", fig.cap="\\label{fig:model_1_explore}Model 1 - Exploratory Plot"}
# Exploratory
```

```{r methodology_model_1}
# model_1 = lm(Y ~ X, data = data)
```

_[[Example Table]]_  

| Model | Specification | Interpretation | Figure |
| :--- | :------ | :-------- | :--- |
| Model 1 | _crmrte~prbarr_ | $\Delta crmrte = \beta_1 \Delta prbarr$ | _\autoref{fig:model_1_fitplots}_ |

```{r methodology_model_1_final, results='asis', fig.cap="\\label{fig:model_1_final}"}
# Stargazer
```

\pagebreak

# Results  

_[[TBD]]_  

\pagebreak

# Conclusion  

_[[TBD]]_  

\pagebreak

# Discussion

_[[TBD]]_  

## Limitations

_[[TBD]]_   

\pagebreak

# Technical Appendix

## Data Dictionary

| Variable Name | Variable | Values | Source | Notes |
| :---- | :-------- | :-------- | :---------- | :----- |
| county | County ID | Odd Integers || Few missing |

\pagebreak

## Exploratory Data Analysis

**Additional steps taken not included in the body of the report**  

_[[TBD]]_  
